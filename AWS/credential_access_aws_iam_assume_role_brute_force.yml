# =======================================================
# QUERY ORIGINAL
# =======================================================
#
# "event.dataset:aws.cloudtrail and\n  event.provider:iam.amazonaws.com and\
# \ event.action:UpdateAssumeRolePolicy and\n  aws.cloudtrail.error_code:MalformedPolicyDocumentException\
# \ and event.outcome:failure\n"
#

- name: AWS IAM Brute Force of Assume Role Policy
  severity: "Medium"
  description: "Identifies a high number of failed attempts to assume an AWS Identity and Access Management (IAM) role. IAM roles are used to delegate access to users or services. An adversary may attempt to enumerate IAM roles in order to determine if a role exists before attempting to assume or hijack the discovered role"
  solution: "https://attack.mitre.org/techniques/T1110/"
  category: "Brute Force"
  tactic: "Credential Access"
  reference: "https://attack.mitre.org/techniques/T1110/"
  frequency: 300
  cache:
    - allOf:
        - field: "logx.aws.cloudtrail"
          operator: "exist"
          value:
        - field: "logx.aws.cloudtrail.eventSource"
          operator: "=="
          value: "iam.amazonaws.com"
        - field: "logx.aws.cloudtrail.eventName"
          operator: "=="
          value: "UpdateAssumeRolePolicy"
        - field: "logx.aws.cloudtrail.errorCode"
          operator: "=="
          value: "MalformedPolicyDocumentException"
      timeLapse: 1200
      minCount: 1
      save:
