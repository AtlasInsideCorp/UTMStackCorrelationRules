# =======================================================
# QUERY ORIGINAL
# =======================================================
#
# event.dataset:aws.cloudtrail and event.provider:guardduty.amazonaws.com
# and event.action:DeleteDetector and event.outcome:success
#

- name: AWS GuardDuty Detector Deletion
  severity: High
  description: "Identifies the deletion of an Amazon GuardDuty detector. Upon deletion, GuardDuty stops monitoring the environment and all existing findings are lost"
  solution:
    "Adversaries may maliciously modify components of a victim environment in order to hinder or disable defensive mechanisms. This not only involves impairing preventative defenses, such as firewalls and anti-virus, but also detection capabilities that defenders can use to audit activity and identify malicious behavior. This may also span both native defenses as well as supplemental capabilities installed by users and administrators.<br>Adversaries could also target event aggregation and analysis mechanisms, or otherwise disrupt these procedures by altering other system components.
    <ol>
    <li>
    </ol>
    "
  category: Impair Defenses
  tactic: Defense Evasion
  reference: https://attack.mitre.org/techniques/T1562/
  frequency: 600
  cache:
    - allOf:
        - field: "logx.aws.cloudtrail"
          operator: "exist"
          value:
        - field: "logx.aws.cloudtrail.eventSource"
          operator: "=="
          value: "guardduty.amazonaws.com"
        - field: "logx.aws.cloudtrail.eventName"
          operator: "=="
          value: "DeleteDetector"
        - field: "logx.aws.cloudtrail.errorCode"
          operator: "not exist"
          value:
        - field: "logx.aws.cloudtrail.errorMessage"
          operator: "not exist"
          value:
      timeLapse: 3600
      minCount: 1
      save:
