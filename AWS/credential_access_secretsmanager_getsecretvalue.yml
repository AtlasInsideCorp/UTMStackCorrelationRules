# =======================================================
# QUERY ORIGINAL
# =======================================================
#
# "event.dataset:aws.cloudtrail and event.provider:secretsmanager.amazonaws.com
#         and event.action:GetSecretValue"
#

- name: "AWS Access Secret in Secrets Manager"
  severity: "High"
  description: "An adversary may attempt to access the secrets in secrets manager to steal certificates, credentials, or other sensitive material"
  solution: "https://attack.mitre.org/techniques/T1528/"
  category: "Steal Application Access Token"
  tactic: "Credential Access"
  reference: "https://attack.mitre.org/techniques/T1528/"
  frequency: 600
  cache:
    - allOf:
        - field: "logx.aws.cloudtrail"
          operator: "exist"
          value:
        - field: "logx.aws.cloudtrail.eventSource"
          operator: "=="
          value: "secretsmanager.amazonaws.com"
        - field: "logx.aws.cloudtrail.eventName"
          operator: "=="
          value: "GetSecretValue"
      timeLapse: 3600
      minCount: 1
      save:
