# Rule version v1.0.0

- name: "Windows: Possible ransomware attack detected"
  severity: "High"
  description: "Ransomware, is a type of malware that prevents users from accessing their system or 
                personal files and requires payment of a ransom in order to gain access to them again. Identifies 
                ransomware attempts"
  solution: "Keep your operating system and applications up to date
    Create backups in case you fall prey to ransomware and cannot decrypt your files. Save the copies on an external hard drive and disconnect it from the computer each time you finish backing up the data.
    Install antivirus applications and content filters for mail servers. These programs significantly reduce the risk of encountering messages with malicious attachments or links in your inbox.
    Install an Internet security solution. This type of software provides real-time protection by blocking any infected files that you try to view or download.
    Avoid links you find in spam emails or on websites you don't know.
    Do not download files from unknown sources."
  category: "Impact"
  tactic: "Data Manipulation"
  reference:
    - "https://attack.mitre.org/tactics/TA0040/"
    - "https://attack.mitre.org/techniques/T1565/"
  frequency: 60
  cache: 
    - allOf:
        - field: "logx.wineventlog.event_id"
          operator: "in"
          value: "4660,4662,4663,4670,4674,5136,5141"
      minCount: 1
      timeLapse: 60
      save:
        - field: "logx.wineventlog.host.name"
          alias: "HostName"
    - allOf:
        - field: "logx.wineventlog.event_id"
          operator: "in"
          value: "4660,4662,4663,4670,4674,5136,5141"
        - field: "logx.wineventlog.host.name"
          operator: "=="
          value: "{{.HostName}}"
      minCount: 10
      timeLapse: 15
      save:
        - field: "logx.wineventlog.event_data.SubjectUserName"
          alias: "SourceUser"
        - field: "logx.wineventlog.host.name"
          alias: "SourceHost"
        - field: "logx.wineventlog.event_data.SourceAddress"
          alias: "SourceIP"
        - field: "logx.wineventlog.event_data.SourcePort"
          alias: "SourcePort"
        - field: "logx.wineventlog.event_data.TargetUserName"
          alias: "DestinationUser"
        - field: "logx.wineventlog.event_data.DestAddress"
          alias: "DestinationIP"
        - field: "logx.wineventlog.event_data.DestPort"
          alias: "DestinationPort"
